<!DOCTYPE html>
<html>
{% load static %}
<head>
		<title>We Called It Earth</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- link rel="icon" type="image/png" href="django static load" sizes="48x48"-->
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<style>
		a:hover {
			   border: 1px dotted red;
		}
		.center {
	  margin: auto;
	  width: 50%;
	  border: 3px solid green;
	  padding: 10px;
		}
		footer {
			text-align: center;
      font-size: xx-small;
		}
		footer a {
			text-decoration-style: dotted;
		}
	  </style>
</head>
<body>
		{% if status == "waitstart" %}
      <div  class="w3-card-4 w3-red center">
      	<p>WAITING FOR A NEW GAME TO START....</p>
      	<script>window.setInterval('window.location.reload()', 5000);</script>
			</div>
    {% elif status == "pickemoji" %}
      <div  class="w3-card-4 w3-yellow center">
  		  You are a creator of a new world, but before you can create, you must learn to tell a <!--new--> story.
				Pick your emoji: <br>
        {% for c in emojis %}
          <span style="font-size:larger"><a href="{% url 'earth_webhome' %}?e={{ c }}">{{ c }}</a> </span>
          {% if forloop.counter|divisibleby:10 %}<br />{% endif %}
        {% endfor %}
      </div>
    {% elif status == "waitprompt" %}
			<div  class="w3-card-4 w3-gray center">
				<p>Hey {{ user.emoji }},
					we are waiting for the Body to find the next story fragment...</p>
					Send energy: <img src="{% static 'test-heart.png' %}" onclick="send_energy('h')">
					{% comment %}{if lastsaid}<p>(Last you said: <i>"{{ lastsaid }}"</i>)</p> {endif}{%endcomment%}
				<script>
				window.setInterval('window.location.reload()', 5000);
				function send_energy(s) {
					var ajax = new XMLHttpRequest();
					var url = '{% url "earth_sendenergy" user.pk %}?energy=' + s;
					ajax.open('GET', url, true);
					/*ajax.onload = function() {...see dreamcity...}*/
					ajax.send();
					/* TODO: add some kind of dramatic effect here to show we sent it! */
				}
			</script>
			</div>
			{% elif status == "dance" %}
				<div  class="w3-card-4 w3-green center">
					<p>ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ VICTORY! ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰</p>
					<!-- Send energy: <img src="{% static 'test-heart.png' %}" onclick="alert('Heart')" -->
				</div>
				<script>
				window.setInterval('window.location.reload()', 5000);
			</script>
			{% elif status == "prompt" %}
			<div  class="w3-card-4 w3-green center">
				<p>{{ prompt.provocation }}</p>
				<form>
					{% comment csrf_token %}{% endcomment %}
					{{ user.emoji }}
					<textarea id="f_text" name="f_text" maxlength=140 onkeyup="count_chars()"></textarea>
					<input type="hidden" id="f_promptpk" name="f_pk" value="{{ prompt.pk }}">
					<input value="â†’" type="submit"> <!-- todo: why not tied to enter key? -->
				</form>
				<span style="font-size:xx-small" id="charsleft"></span>
				{% if lastsaid %}<p>(Last you said: <i>"{{ lastsaid }}"</i>)</p> {% endif %}
				<script>
				document.getElementById('f_text').focus();
				window.setInterval('try_refresh()', 6000);

				function count_chars() {
					// show characters remaining to 140
					var ta = document.getElementById('f_text');
					var nl = 140 - ta.value.length;
					var scl = document.getElementById('charsleft');
					scl.textContent = "(" + nl + " characters left)";
				}

				function try_refresh() {
					var ta = document.getElementById('f_text');
					if (ta.value == "") {
						window.location.reload();
					}
					else {
						window.setInterval('try_refresh()', 6000);
					}

				}
				</script>
			</div>
		{% else %}
			<div  class="w3-card-4 w3-red center">
				<p>IMPOSSIBLE ERROR</p>
			</div>
		{% endif %}

	<footer>
		"We Called It Earth", by Jessica Renfro & Hadi Asghari
	</footer>
	 <script>
	 </script>
</body>
</html>
